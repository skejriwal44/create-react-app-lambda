{"ast":null,"code":"import _regeneratorRuntime from\"/Users/shagarw/Downloads/create-react-app-lambda/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/shagarw/Downloads/create-react-app-lambda/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/shagarw/Downloads/create-react-app-lambda/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from\"react\";import axios from'axios';import{useHistory}from\"react-router-dom\";import{ChatEngine as ChatEngine1,getOrCreateChat}from'react-chat-engine';import{ChatEngine as ChatEngine2}from'react-chat-engine';import{useAuth}from\"../contexts/AuthContext\";import{auth}from\"../firebase\";export default function Chats(){var didMountRef=useRef(false);var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useAuth=useAuth(),user=_useAuth.user;var history=useHistory();function handleLogout(){return _handleLogout.apply(this,arguments);}function _handleLogout(){_handleLogout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signOut();case 2:history.push(\"/\");case 3:case\"end\":return _context.stop();}}},_callee);}));return _handleLogout.apply(this,arguments);}function getFile(_x){return _getFile.apply(this,arguments);}function _getFile(){_getFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"https://cors-anywhere.herokuapp.com/\"+url);url=\"https://cors-anywhere.herokuapp.com/\"+url;_context2.next=4;return fetch(url);case 4:response=_context2.sent;_context2.next=7;return response.blob();case 7:data=_context2.sent;return _context2.abrupt(\"return\",new File([data],\"test.jpg\",{type:'image/jpeg'}));case 9:case\"end\":return _context2.stop();}}},_callee2);}));return _getFile.apply(this,arguments);}useEffect(function(){if(!didMountRef.current){didMountRef.current=true;if(!user||user===null){history.push(\"/\");return;}// Get-or-Create should be in a Firebase Function\naxios.get('https://api.chatengine.io/users/me/',{headers:{\"project-id\":'3d7fabcc-f5f4-4bfe-ae0a-34cd71c9b916',\"user-name\":user.email,\"user-secret\":user.uid}}).then(function(){return setLoading(false);}).catch(function(e){var formdata=new FormData();formdata.append('email',user.email);formdata.append('username',user.email);formdata.append('secret',user.uid);getFile(user.photoURL).then(function(avatar){console.log(avatar);// formdata.append('avatar', avatar, avatar.name)\naxios.post('https://api.chatengine.io/users/',formdata,{headers:{\"private-key\":\"015c9875-80f1-4d12-91a1-66388f883692\"}}).then(function(){setLoading(false);}).catch(function(e){return console.log('e',e.response);});});});axios.get('https://api.chatengine.io/users/me/',{headers:{\"project-id\":'6d68dbc1-8843-403d-a512-781c5d48182e',\"user-name\":user.email,\"user-secret\":user.uid}}).then(function(){return setLoading(false);}).catch(function(e){console.log(e);var formdata=new FormData();formdata.append('email',user.email);formdata.append('username',user.email);formdata.append('secret',user.uid);getFile(user.photoURL).then(function(avatar){// formdata.append('avatar', avatar, avatar.name)\nconsole.log(user);axios.post('https://api.chatengine.io/users/',formdata,{headers:{\"private-key\":\"02d6777d-c38c-4581-bcbd-8055edcdb2e4\"}}).then(function(){setLoading(false);}).catch(function(e){return console.log('e',e.response);});});});// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n}},[user,history]);useEffect(function(){if(!user||user===null){history.push(\"/\");return;}var payload={\"username\":user.email};axios.post('https://api.chatengine.io/chats/135591/people/',payload,{headers:{'Project-ID':'3d7fabcc-f5f4-4bfe-ae0a-34cd71c9b916','User-Name':'asasdd','User-Secret':'aa'}}).then(function(res){});},[user,history]);useEffect(function(){if(!user||user===null){console.log(\"Here_null\");history.push(\"/\");return;}var payload={\"usernames\":[\"Live_Offers\"],\"title\":\"Live Offers\",\"is_direct_chat\":true};axios.put('https://api.chatengine.io/chats/',payload,{headers:{'Project-ID':'6d68dbc1-8843-403d-a512-781c5d48182e','User-Name':user.email,'User-Secret':user.uid}}).then(function(res){});},[user,history]);if(!user||loading)return/*#__PURE__*/React.createElement(\"div\",null);return/*#__PURE__*/React.createElement(\"div\",{className:\"chats-page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"logo-tab\"},\"Livestream\"),/*#__PURE__*/React.createElement(\"div\",{onClick:handleLogout,className:\"logout-tab\"},\"Logout\")),/*#__PURE__*/React.createElement(ChatEngine2,{height:\"calc(99vh - 66px)\",projectID:\"3d7fabcc-f5f4-4bfe-ae0a-34cd71c9b916\",userName:user.email,userSecret:user.uid,renderChatList:function renderChatList(chatAppState){return/*#__PURE__*/React.createElement(\"iframe\",{id:\"ytplayer\",width:\"100%\",height:\"73.75%\",src:\"https://www.youtube.com/embed/-zk7FTN9dC0?autoplay=1&rel=0&modestbranding=1;\",title:\"YouTube video player\",frameborder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",allowfullscreen:true});},renderChatSettings:function renderChatSettings(){return null;},offset:6}),/*#__PURE__*/React.createElement(ChatEngine1,{height:\"calc(99vh - 66px)\",projectID:\"6d68dbc1-8843-403d-a512-781c5d48182e\",userName:user.email,userSecret:user.uid,renderChatList:function renderChatList(chatAppState){return null;},renderChatSettings:function renderChatSettings(){return null;},offset:6}));}","map":{"version":3,"names":["React","useRef","useState","useEffect","axios","useHistory","ChatEngine","ChatEngine1","getOrCreateChat","ChatEngine2","useAuth","auth","Chats","didMountRef","loading","setLoading","user","history","handleLogout","signOut","push","getFile","url","console","log","fetch","response","blob","data","File","type","current","get","headers","email","uid","then","catch","e","formdata","FormData","append","photoURL","avatar","post","payload","res","put","chatAppState"],"sources":["/Users/shagarw/Downloads/create-react-app-lambda/src/components/Chats.js"],"sourcesContent":["import React, { useRef, useState, useEffect } from \"react\"\n\n\nimport axios from 'axios'\nimport { useHistory } from \"react-router-dom\"\nimport { \n  ChatEngine as ChatEngine1, getOrCreateChat\n} from 'react-chat-engine'\n\nimport { \n  ChatEngine as ChatEngine2\n} from 'react-chat-engine'\n\nimport { useAuth } from \"../contexts/AuthContext\"\n\nimport { auth } from \"../firebase\"\n\n\nexport default function Chats() {\n  const didMountRef = useRef(false)\n  const [ loading, setLoading ] = useState(true)\n  const { user } = useAuth()\n  const history = useHistory()\n\n\n\n  async function handleLogout() {\n    await auth.signOut()\n    history.push(\"/\")\n  }\n\n  async function getFile(url) {\n    console.log(\"https://cors-anywhere.herokuapp.com/\"+url);\n    url = \"https://cors-anywhere.herokuapp.com/\"+url;\n    let response = await fetch(url);\n    let data = await response.blob();\n    return new File([data], \"test.jpg\", { type: 'image/jpeg' });\n  }\n\n  useEffect(() => {\n    if (!didMountRef.current) {\n      didMountRef.current = true\n\n      if (!user || user === null) {\n        history.push(\"/\")\n        return\n      }\n      // Get-or-Create should be in a Firebase Function\n      axios.get(\n        'https://api.chatengine.io/users/me/',\n        { headers: { \n          \"project-id\": '3d7fabcc-f5f4-4bfe-ae0a-34cd71c9b916',\n          \"user-name\": user.email,\n          \"user-secret\": user.uid\n        }}\n      )\n\n      .then(() => setLoading(false))\n\n      .catch(e => {\n        let formdata = new FormData()\n        formdata.append('email', user.email)\n        formdata.append('username', user.email)\n        formdata.append('secret', user.uid)\n\n        getFile(user.photoURL)\n        .then(avatar => {\n          console.log(avatar)\n          // formdata.append('avatar', avatar, avatar.name)\n        \n\n          axios.post(\n            'https://api.chatengine.io/users/',\n            formdata,\n            { headers: { \"private-key\": \"015c9875-80f1-4d12-91a1-66388f883692\" }}\n          )\n          .then(() => {setLoading(false);\n          })\n          .catch(e => console.log('e', e.response))\n        })\n      })\n\n      axios.get(\n        'https://api.chatengine.io/users/me/',\n        { headers: { \n          \"project-id\": '6d68dbc1-8843-403d-a512-781c5d48182e',\n          \"user-name\": user.email,\n          \"user-secret\": user.uid\n        }}\n      )\n      .then(() => setLoading(false))\n      .catch(e => {\n        console.log(e)\n        let formdata = new FormData()\n        formdata.append('email', user.email)\n        formdata.append('username', user.email)\n        formdata.append('secret', user.uid)\n\n        getFile(user.photoURL)\n        .then(avatar => {\n          // formdata.append('avatar', avatar, avatar.name)\n        \n          console.log(user)\n          axios.post(\n            'https://api.chatengine.io/users/',\n            formdata,\n            { headers: { \"private-key\": \"02d6777d-c38c-4581-bcbd-8055edcdb2e4\" }}\n          )\n          .then(() => {setLoading(false);\n            })\n          .catch(e => console.log('e', e.response))\n        })\n      })\n      \n      // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    }\n  }, [user, history])\n\n\n  useEffect(() => {\n\n      if (!user || user === null) {\n        history.push(\"/\")\n        return\n      }\n    let payload =  {\"username\": user.email}\n    axios.post(\n      'https://api.chatengine.io/chats/135591/people/',\n      payload,\n      {headers : {\n        'Project-ID': '3d7fabcc-f5f4-4bfe-ae0a-34cd71c9b916',\n        'User-Name': 'asasdd',\n        'User-Secret': 'aa'\n      }}\n\n    )\n    .then(res => {})\n    \n  }, [user, history])\n\n  useEffect(() => {\n    if (!user || user === null) {\n      console.log(\"Here_null\")\n      history.push(\"/\")\n      return\n    }\n  let payload = { \"usernames\": [\"Live_Offers\"],\"title\": \"Live Offers\" ,\"is_direct_chat\": true};\n  axios.put(\n    'https://api.chatengine.io/chats/',\n    payload,\n    {headers : {\n      'Project-ID': '6d68dbc1-8843-403d-a512-781c5d48182e',\n      'User-Name': user.email,\n      'User-Secret': user.uid\n    }}\n  )\n  .then(res => { \n    })\n\n  \n}, [user, history])\n\n  if (!user || loading) return <div />\n\n  return (\n    <div className='chats-page'>\n      <div className='nav-bar'>\n        <div className='logo-tab'>\n          Livestream\n        </div>\n\n        <div onClick={handleLogout} className='logout-tab'>\n          Logout\n        </div>\n      </div>\n      <ChatEngine2\n        height='calc(99vh - 66px)'\n        projectID='3d7fabcc-f5f4-4bfe-ae0a-34cd71c9b916'\n        userName={user.email}\n        userSecret={user.uid}\n        renderChatList={\n          \n          (chatAppState) => {return (<iframe  id=\"ytplayer\" width=\"100%\" height=\"73.75%\" src=\"https://www.youtube.com/embed/-zk7FTN9dC0?autoplay=1&amp;rel=0&amp;modestbranding=1;\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>)}\n        }\n        renderChatSettings={() => {return (null);}}\n        offset={6}\n      />\n\n      <ChatEngine1\n        height='calc(99vh - 66px)'\n        projectID='6d68dbc1-8843-403d-a512-781c5d48182e'\n        userName={user.email}\n        userSecret={user.uid}\n        renderChatList={(chatAppState) => {return (null);}}\n        renderChatSettings={() => {return (null);}}\n        offset={6}\n      />\n      </div>\n\n      \n  )\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}